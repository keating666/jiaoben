<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¬ æŠ–éŸ³è§†é¢‘è½¬åˆ†é•œè„šæœ¬</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        input {
            flex: 1;
            padding: 15px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }
        .btn {
            padding: 15px 30px;
            font-size: 16px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            white-space: nowrap;
        }
        .btn:hover {
            background: #218838;
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .process-steps {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .step {
            text-align: center;
            opacity: 0.5;
        }
        .step.active {
            opacity: 1;
            font-weight: bold;
        }
        .step.completed {
            opacity: 1;
            color: #28a745;
        }
        .results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .result-box {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .result-box h3 {
            margin-top: 0;
            color: #0056b3;
        }
        .audio-player {
            width: 100%;
            margin: 10px 0;
        }
        .transcript {
            background: white;
            padding: 15px;
            border-radius: 5px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        .script {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 5px;
            max-height: 500px;
            overflow-y: auto;
        }
        .script-section {
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .loading {
            text-align: center;
            padding: 20px;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #28a745;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .video-info {
            background: #d4edda;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¬ æŠ–éŸ³è§†é¢‘è½¬åˆ†é•œè„šæœ¬</h1>
        <div class="subtitle">ç®€å•ç›´æ¥ï¼šè·å–éŸ³é¢‘ â†’ AIè½¬æ–‡å­— â†’ ç”Ÿæˆåˆ†é•œè„šæœ¬</div>
        
        <div class="input-group">
            <input type="text" 
                   id="douyinUrl" 
                   placeholder="ç²˜è´´æŠ–éŸ³åˆ†äº«é“¾æ¥..." 
                   value="https://v.douyin.com/67CMClLwb1c/">
            <button class="btn" onclick="processVideo()" id="processBtn">
                å¼€å§‹å¤„ç†
            </button>
        </div>
        
        <div class="process-steps">
            <div class="step" id="step1">
                <div>ğŸ”</div>
                <div>è§£æè§†é¢‘</div>
            </div>
            <div class="step" id="step2">
                <div>ğŸµ</div>
                <div>æå–éŸ³é¢‘</div>
            </div>
            <div class="step" id="step3">
                <div>ğŸ“</div>
                <div>è½¬æ¢æ–‡å­—</div>
            </div>
            <div class="step" id="step4">
                <div>ğŸ¬</div>
                <div>ç”Ÿæˆè„šæœ¬</div>
            </div>
        </div>
        
        <div id="videoInfo" class="video-info" style="display:none;"></div>
        
        <div id="results" class="results" style="display:none;">
            <div class="result-box">
                <h3>ğŸµ éŸ³é¢‘æ–‡ä»¶</h3>
                <audio id="audioPlayer" class="audio-player" controls></audio>
                <p id="audioInfo"></p>
            </div>
            
            <div class="result-box">
                <h3>ğŸ“ è½¬æ¢çš„æ–‡å­—</h3>
                <div id="transcript" class="transcript">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>æ­£åœ¨è½¬æ¢æ–‡å­—...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="scriptResult" class="result-box" style="display:none; margin-top:20px;">
            <h3>ğŸ¬ åˆ†é•œè„šæœ¬</h3>
            <div id="script" class="script"></div>
        </div>
        
        <div id="error" class="error" style="display:none;"></div>
    </div>
    
    <script>
        const WORKER_URL = 'https://jiaoben-api.keating8500.workers.dev';
        let currentAudioUrl = null;
        
        function updateStep(stepNum) {
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById(`step${i}`);
                step.classList.remove('active', 'completed');
                if (i < stepNum) step.classList.add('completed');
                if (i === stepNum) step.classList.add('active');
            }
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.style.display = 'block';
            errorDiv.textContent = message;
        }
        
        async function processVideo() {
            const douyinUrl = document.getElementById('douyinUrl').value.trim();
            if (!douyinUrl) {
                showError('è¯·è¾“å…¥æŠ–éŸ³é“¾æ¥');
                return;
            }
            
            const btn = document.getElementById('processBtn');
            btn.disabled = true;
            btn.textContent = 'å¤„ç†ä¸­...';
            
            document.getElementById('error').style.display = 'none';
            document.getElementById('results').style.display = 'none';
            document.getElementById('scriptResult').style.display = 'none';
            
            try {
                // æ­¥éª¤1ï¼šè§£æè§†é¢‘
                updateStep(1);
                const response = await fetch(`${WORKER_URL}/api/process`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ douyinUrl })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'è§£æå¤±è´¥');
                }
                
                // æ˜¾ç¤ºè§†é¢‘ä¿¡æ¯
                const videoInfoDiv = document.getElementById('videoInfo');
                videoInfoDiv.style.display = 'block';
                videoInfoDiv.innerHTML = `
                    <h4>ğŸ“¹ è§†é¢‘ä¿¡æ¯</h4>
                    <p><strong>æ ‡é¢˜ï¼š</strong>${data.videoInfo.title}</p>
                    <p><strong>ä½œè€…ï¼š</strong>${data.videoInfo.author}</p>
                    <p><strong>éŸ³é¢‘æ–‡ä»¶ï¼š</strong>${data.selectedUrl.type === 'music' ? 'èƒŒæ™¯éŸ³ä¹' : 'è§†é¢‘éŸ³è½¨'} (${data.selectedUrl.length}å­—ç¬¦)</p>
                `;
                
                // æ­¥éª¤2ï¼šéŸ³é¢‘å·²è·å–
                updateStep(2);
                currentAudioUrl = data.selectedUrl.url;
                
                // æ˜¾ç¤ºéŸ³é¢‘æ’­æ”¾å™¨
                document.getElementById('results').style.display = 'grid';
                document.getElementById('audioPlayer').src = currentAudioUrl;
                document.getElementById('audioInfo').textContent = `URLé•¿åº¦: ${currentAudioUrl.length} å­—ç¬¦`;
                
                // æ­¥éª¤3ï¼šè½¬æ¢æ–‡å­—ï¼ˆä½¿ç”¨AIï¼‰
                updateStep(3);
                await transcribeAudio(currentAudioUrl);
                
                // æ­¥éª¤4ï¼šç”Ÿæˆåˆ†é•œè„šæœ¬
                updateStep(4);
                await generateScript();
                
            } catch (error) {
                showError(`é”™è¯¯: ${error.message}`);
            } finally {
                btn.disabled = false;
                btn.textContent = 'å¼€å§‹å¤„ç†';
            }
        }
        
        async function transcribeAudio(audioUrl) {
            // è¿™é‡Œåº”è¯¥è°ƒç”¨ AI API æ¥è½¬æ¢éŸ³é¢‘
            // æš‚æ—¶ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
            const transcriptDiv = document.getElementById('transcript');
            
            // æ¨¡æ‹Ÿ AI è½¬æ–‡å­—ç»“æœ
            setTimeout(() => {
                transcriptDiv.innerHTML = `
è€æ¿ï¼šç›¸åŒçš„äº§å“ä¸ºä»€ä¹ˆä»·æ ¼å·®è·è¿™ä¹ˆå¤§ï¼Ÿ

å‘˜å·¥ï¼šè€æ¿ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸ºåŸææ–™å’Œå·¥è‰ºçš„å·®å¼‚ã€‚

è€æ¿ï¼šå…·ä½“è¯´è¯´çœ‹ã€‚

å‘˜å·¥ï¼šæ¯”å¦‚è¿™ä¸¤ä¸ªçœ‹èµ·æ¥ç›¸ä¼¼çš„æœ¨æäº§å“ï¼Œä¸€ä¸ªç”¨çš„æ˜¯å®æœ¨ï¼Œå¦ä¸€ä¸ªç”¨çš„æ˜¯å¤åˆæ¿ã€‚å®æœ¨çš„æˆæœ¬è‡ªç„¶é«˜å¾ˆå¤šã€‚

è€æ¿ï¼šé‚£å®¢æˆ·èƒ½çœ‹å‡ºåŒºåˆ«å—ï¼Ÿ

å‘˜å·¥ï¼šå†…è¡Œçš„å®¢æˆ·ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¥ï¼Œæ™®é€šå®¢æˆ·å¯èƒ½éœ€è¦æˆ‘ä»¬è§£é‡Šã€‚

è€æ¿ï¼šé‚£æˆ‘ä»¬åº”è¯¥æ€ä¹ˆå®šä»·ï¼Ÿ

å‘˜å·¥ï¼šæˆ‘å»ºè®®æ ¹æ®ä¸åŒå®¢æˆ·ç¾¤ä½“ï¼Œæä¾›ä¸åŒæ¡£æ¬¡çš„äº§å“é€‰æ‹©ã€‚
                `;
            }, 2000);
        }
        
        async function generateScript() {
            const transcript = document.getElementById('transcript').textContent;
            const scriptDiv = document.getElementById('script');
            
            // æ¨¡æ‹Ÿ AI ç”Ÿæˆåˆ†é•œè„šæœ¬
            setTimeout(() => {
                document.getElementById('scriptResult').style.display = 'block';
                scriptDiv.innerHTML = `
                    <div class="script-section">
                        <h4>åœºæ™¯1ï¼šåŠå…¬å®¤å…¨æ™¯</h4>
                        <p><strong>æ—¶é—´ï¼š</strong>0:00-0:03</p>
                        <p><strong>ç”»é¢ï¼š</strong>è€æ¿ååœ¨åŠå…¬æ¡Œå‰ï¼Œé¢å‰æ‘†ç€ä¸¤ä¸ªæœ¨ææ ·å“</p>
                        <p><strong>å¯¹è¯ï¼š</strong>è€æ¿ï¼š"ç›¸åŒçš„äº§å“ä¸ºä»€ä¹ˆä»·æ ¼å·®è·è¿™ä¹ˆå¤§ï¼Ÿ"</p>
                        <p><strong>é•œå¤´ï¼š</strong>ä¸­æ™¯ï¼Œç¼“æ…¢æ¨è¿›</p>
                    </div>
                    
                    <div class="script-section">
                        <h4>åœºæ™¯2ï¼šå‘˜å·¥ç‰¹å†™</h4>
                        <p><strong>æ—¶é—´ï¼š</strong>0:03-0:06</p>
                        <p><strong>ç”»é¢ï¼š</strong>å‘˜å·¥æ‹¿èµ·æ ·å“ï¼Œå‡†å¤‡è§£é‡Š</p>
                        <p><strong>å¯¹è¯ï¼š</strong>å‘˜å·¥ï¼š"è€æ¿ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸ºåŸææ–™å’Œå·¥è‰ºçš„å·®å¼‚ã€‚"</p>
                        <p><strong>é•œå¤´ï¼š</strong>ç‰¹å†™å‘˜å·¥è¡¨æƒ…ï¼Œè‡ªä¿¡ä¸“ä¸š</p>
                    </div>
                    
                    <div class="script-section">
                        <h4>åœºæ™¯3ï¼šäº§å“å¯¹æ¯”</h4>
                        <p><strong>æ—¶é—´ï¼š</strong>0:06-0:12</p>
                        <p><strong>ç”»é¢ï¼š</strong>ä¸¤ä¸ªäº§å“çš„å¯¹æ¯”ç‰¹å†™</p>
                        <p><strong>å¯¹è¯ï¼š</strong>å‘˜å·¥ï¼š"æ¯”å¦‚è¿™ä¸¤ä¸ªçœ‹èµ·æ¥ç›¸ä¼¼çš„æœ¨æäº§å“..."</p>
                        <p><strong>é•œå¤´ï¼š</strong>ç‰¹å†™äº§å“ç»†èŠ‚ï¼Œå±•ç¤ºæè´¨å·®å¼‚</p>
                    </div>
                    
                    <div class="script-section">
                        <h4>åœºæ™¯4ï¼šäº’åŠ¨è®¨è®º</h4>
                        <p><strong>æ—¶é—´ï¼š</strong>0:12-0:18</p>
                        <p><strong>ç”»é¢ï¼š</strong>è€æ¿å’Œå‘˜å·¥çš„å¯¹è¯åœºæ™¯</p>
                        <p><strong>å¯¹è¯ï¼š</strong>å…³äºå®¢æˆ·è¯†åˆ«å’Œå®šä»·ç­–ç•¥çš„è®¨è®º</p>
                        <p><strong>é•œå¤´ï¼š</strong>åŒäººä¸­æ™¯ï¼Œæ¥å›åˆ‡æ¢</p>
                    </div>
                `;
            }, 3000);
        }
    </script>
</body>
</html>