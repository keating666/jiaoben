<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†æ URL é•¿åº¦é—®é¢˜</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #333; text-align: center; }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 10px 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn:hover { background: #0056b3; }
        .url-item {
            margin: 10px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        .url-item.short {
            background: #d4edda;
            border-color: #c3e6cb;
        }
        .url-item.long {
            background: #f8d7da;
            border-color: #f5c6cb;
        }
        .url-text {
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 3px;
        }
        .length {
            font-weight: bold;
            font-size: 16px;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ åˆ†æ URL é•¿åº¦é—®é¢˜</h1>
        
        <div class="warning">
            <h3>âš ï¸ äº‘çŒ« API é™åˆ¶</h3>
            <p>äº‘çŒ«è¦æ±‚æ–‡ä»¶URLä¸èƒ½è¶…è¿‡ <strong>200ä¸ªå­—ç¬¦</strong></p>
            <p>æŠ–éŸ³è§†é¢‘URLé€šå¸¸æœ‰ 300-400 ä¸ªå­—ç¬¦ï¼Œéœ€è¦ä½¿ç”¨çŸ­é“¾æ¥æœåŠ¡</p>
        </div>
        
        <button class="btn" onclick="analyzeUrls()">åˆ†æå½“å‰è§†é¢‘çš„æ‰€æœ‰URL</button>
        <button class="btn" onclick="testShortUrl()">æµ‹è¯•çŸ­é“¾æ¥æ–¹æ¡ˆ</button>
        
        <div id="results"></div>
    </div>
    
    <script>
        const WORKER_URL = 'https://jiaoben-api.keating8500.workers.dev';
        const TEST_DOUYIN_URL = 'https://v.douyin.com/67CMClLwb1c/';
        
        async function analyzeUrls() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>æ­£åœ¨åˆ†æ...</p>';
            
            try {
                const response = await fetch(`${WORKER_URL}/api/tikhub/test`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ douyinUrl: TEST_DOUYIN_URL })
                });
                
                const data = await response.json();
                
                if (data.success && data.availableUrls) {
                    let html = '<h3>æ‰€æœ‰å¯ç”¨çš„è§†é¢‘URLï¼š</h3>';
                    
                    data.availableUrls.forEach((urlInfo, index) => {
                        const isShort = urlInfo.length <= 200;
                        html += `
                            <div class="url-item ${isShort ? 'short' : 'long'}">
                                <div>
                                    <strong>${index + 1}. ${urlInfo.type}[${urlInfo.index}]</strong>
                                    <span class="length ${isShort ? 'success' : 'error'}">
                                        é•¿åº¦: ${urlInfo.length} å­—ç¬¦ ${isShort ? 'âœ…' : 'âŒ'}
                                    </span>
                                </div>
                                <div class="url-text">${urlInfo.url}</div>
                            </div>
                        `;
                    });
                    
                    if (data.shortestUrl) {
                        html += `
                            <div style="margin-top: 30px; padding: 20px; background: #e7f3ff; border-radius: 5px;">
                                <h3>æœ€çŸ­çš„URLï¼š</h3>
                                <p>ç±»å‹ï¼š${data.shortestUrl.type}[${data.shortestUrl.index}]</p>
                                <p>é•¿åº¦ï¼š<strong>${data.shortestUrl.length}</strong> å­—ç¬¦</p>
                                ${data.shortestUrl.length <= 200 ? 
                                    '<p class="success">âœ… å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼</p>' : 
                                    '<p class="error">âŒ ä»ç„¶å¤ªé•¿ï¼Œéœ€è¦çŸ­é“¾æ¥æœåŠ¡</p>'
                                }
                            </div>
                        `;
                    }
                    
                    resultsDiv.innerHTML = html;
                } else {
                    resultsDiv.innerHTML = `<p class="error">è·å–å¤±è´¥ï¼š${JSON.stringify(data)}</p>`;
                }
            } catch (error) {
                resultsDiv.innerHTML = `<p class="error">é”™è¯¯ï¼š${error.message}</p>`;
            }
        }
        
        async function testShortUrl() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>æµ‹è¯•çŸ­é“¾æ¥æœåŠ¡...</p>';
            
            const longUrl = 'https://v5-dy-o-abtest.zjcdn.com/7390b7b149693a9718b04432d95b509e/6888c11f/video/tos/cn/tos-cn-ve-15/oUysIPHC32EAiEKEaIwQaAqPQU9EIQgBiyZHS/?a=6383&ch=26&cr=3&dr=0&lr=all&cd=0%7C0%7C0%7C3&cv=1&br=784&bt=784&cs=0&ds=4&ft=LUGqLeFmsQOCCp5Sup-Q6_Mme-rLWa5eFsPqhSd-IXGjjqkwUBMEq&mime_type=video_mp4&qs=0&rc=Ojo2ZGc0Zjc5ZWdoZzhlZEBpanNkOGw5cmo7NTMzNGkzM0AxMzFiL19gNmAxNGFgYjMuYSNvbDAvMmQ0Yi9hLS1kLTBzcw%3D%3D&btag=80000e00020000&cquery=100H_100K_100o_100w_100B&dy_q=1753781948&feature_id=46a7bb47b4fd1280f3d3825bf2b29388&l=20250729173908320428EEA2716D2FA0BC';
            
            let html = `
                <h3>æµ‹è¯•çŸ­é“¾æ¥æœåŠ¡</h3>
                <p>åŸå§‹URLé•¿åº¦ï¼š<strong class="error">${longUrl.length} å­—ç¬¦</strong></p>
                <div class="url-text">${longUrl}</div>
                <h4>æµ‹è¯•ç»“æœï¼š</h4>
            `;
            
            // æµ‹è¯• TinyURL
            try {
                const tinyResponse = await fetch(`https://tinyurl.com/api-create.php?url=${encodeURIComponent(longUrl)}`);
                if (tinyResponse.ok) {
                    const shortUrl = await tinyResponse.text();
                    html += `<p class="success">âœ… TinyURL: ${shortUrl.trim()} (${shortUrl.trim().length} å­—ç¬¦)</p>`;
                }
            } catch (e) {
                html += `<p class="error">âŒ TinyURL å¤±è´¥: ${e.message}</p>`;
            }
            
            // å»ºè®®çš„è§£å†³æ–¹æ¡ˆ
            html += `
                <div style="margin-top: 30px; padding: 20px; background: #d4edda; border-radius: 5px;">
                    <h3>ğŸ’¡ è§£å†³æ–¹æ¡ˆ</h3>
                    <ol>
                        <li><strong>ä½¿ç”¨ Worker å†…ç½®çŸ­é“¾æ¥</strong> - å·²åœ¨æ–°ç‰ˆæœ¬ä¸­å®ç°</li>
                        <li><strong>ä½¿ç”¨æŠ–éŸ³å®˜æ–¹çŸ­é“¾æ¥</strong> - download_addr çš„ç¬¬3ä¸ªURLé€šå¸¸è¾ƒçŸ­</li>
                        <li><strong>ç¬¬ä¸‰æ–¹çŸ­é“¾æ¥æœåŠ¡</strong> - TinyURLã€is.gd ç­‰</li>
                        <li><strong>è‡ªå»ºçŸ­é“¾æ¥æœåŠ¡</strong> - ä½¿ç”¨ Cloudflare KV å­˜å‚¨æ˜ å°„</li>
                    </ol>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åˆ†æ
        window.onload = analyzeUrls;
    </script>
</body>
</html>