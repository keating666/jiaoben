<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸµ åˆ†æåª’ä½“æ–‡ä»¶</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #333; text-align: center; }
        h2 { color: #007bff; margin-top: 30px; }
        input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
            box-sizing: border-box;
        }
        .btn {
            padding: 12px 24px;
            font-size: 16;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }
        .btn:hover { background: #0056b3; }
        .stats {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .url-item {
            margin: 10px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        .url-item.audio {
            background: #fff3cd;
            border-color: #ffeaa7;
        }
        .url-item.short {
            background: #d4edda;
            border-color: #c3e6cb;
        }
        .url-text {
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            margin: 5px 0;
            color: #495057;
        }
        .length { font-weight: bold; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .loading { color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ åˆ†æåª’ä½“æ–‡ä»¶</h1>
        
        <input type="text" 
               id="douyinUrl" 
               placeholder="ç²˜è´´æŠ–éŸ³åˆ†äº«é“¾æ¥..." 
               value="https://v.douyin.com/67CMClLwb1c/">
        
        <button class="btn" onclick="analyzeMedia()">åˆ†ææ‰€æœ‰åª’ä½“URL</button>
        <button class="btn" onclick="processWithAudio()">ä½¿ç”¨éŸ³é¢‘å¤„ç†</button>
        
        <div id="results"></div>
    </div>
    
    <script>
        const WORKER_URL = 'https://jiaoben-api.keating8500.workers.dev';
        
        function showLoading(message) {
            document.getElementById('results').innerHTML = `<p class="loading">${message}</p>`;
        }
        
        async function analyzeMedia() {
            const douyinUrl = document.getElementById('douyinUrl').value.trim();
            if (!douyinUrl) {
                alert('è¯·è¾“å…¥æŠ–éŸ³é“¾æ¥');
                return;
            }
            
            showLoading('æ­£åœ¨åˆ†æåª’ä½“æ–‡ä»¶...');
            
            try {
                const response = await fetch(`${WORKER_URL}/api/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ douyinUrl })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    let html = `
                        <div class="stats">
                            <h3>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h3>
                            <p>æ€»URLæ•°ï¼š${data.stats.totalUrls}</p>
                            <p>éŸ³é¢‘æ–‡ä»¶ï¼š${data.stats.audioUrls} ä¸ªï¼ˆçŸ­é“¾æ¥ï¼š${data.stats.shortAudioUrls} ä¸ªï¼‰</p>
                            <p>è§†é¢‘æ–‡ä»¶ï¼š${data.stats.videoUrls} ä¸ªï¼ˆçŸ­é“¾æ¥ï¼š${data.stats.shortVideoUrls} ä¸ªï¼‰</p>
                            <p><strong>å»ºè®®ï¼š</strong>${data.recommendation}</p>
                        </div>
                    `;
                    
                    if (data.audioUrls.length > 0) {
                        html += '<h2>ğŸµ éŸ³é¢‘æ–‡ä»¶</h2>';
                        data.audioUrls.forEach((item, index) => {
                            const isShort = item.length <= 200;
                            html += `
                                <div class="url-item audio ${isShort ? 'short' : ''}">
                                    <strong>${index + 1}. ${item.path}</strong>
                                    <span class="length ${isShort ? 'success' : 'error'}">
                                        (${item.length} å­—ç¬¦) ${isShort ? 'âœ…' : 'âŒ'}
                                    </span>
                                    <div class="url-text">${item.url}</div>
                                </div>
                            `;
                        });
                    }
                    
                    if (data.videoUrls.length > 0) {
                        html += '<h2>ğŸ“¹ è§†é¢‘æ–‡ä»¶</h2>';
                        data.videoUrls.slice(0, 5).forEach((item, index) => {
                            const isShort = item.length <= 200;
                            html += `
                                <div class="url-item ${isShort ? 'short' : ''}">
                                    <strong>${index + 1}. ${item.path}</strong>
                                    <span class="length ${isShort ? 'success' : 'error'}">
                                        (${item.length} å­—ç¬¦) ${isShort ? 'âœ…' : 'âŒ'}
                                    </span>
                                    <div class="url-text">${item.url}</div>
                                </div>
                            `;
                        });
                        if (data.videoUrls.length > 5) {
                            html += `<p>...è¿˜æœ‰ ${data.videoUrls.length - 5} ä¸ªè§†é¢‘URL</p>`;
                        }
                    }
                    
                    document.getElementById('results').innerHTML = html;
                } else {
                    document.getElementById('results').innerHTML = `
                        <div class="url-item error">
                            <strong>âŒ åˆ†æå¤±è´¥</strong>
                            <p>${data.error || 'æœªçŸ¥é”™è¯¯'}</p>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('results').innerHTML = `
                    <div class="url-item error">
                        <strong>âŒ ç½‘ç»œé”™è¯¯</strong>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function processWithAudio() {
            const douyinUrl = document.getElementById('douyinUrl').value.trim();
            if (!douyinUrl) {
                alert('è¯·è¾“å…¥æŠ–éŸ³é“¾æ¥');
                return;
            }
            
            showLoading('æ­£åœ¨å¤„ç†ï¼ˆä¼˜å…ˆä½¿ç”¨éŸ³é¢‘ï¼‰...');
            
            try {
                const response = await fetch(`${WORKER_URL}/api/process`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ douyinUrl })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('results').innerHTML = `
                        <div class="url-item short">
                            <h3>âœ… å¤„ç†æˆåŠŸï¼</h3>
                            <p><strong>ä½¿ç”¨çš„æ–‡ä»¶ç±»å‹ï¼š</strong>${data.selectedUrl.type === 'music' ? 'ğŸµ éŸ³é¢‘æ–‡ä»¶' : 'ğŸ“¹ è§†é¢‘æ–‡ä»¶'}</p>
                            <p><strong>URLé•¿åº¦ï¼š</strong>${data.selectedUrl.length} å­—ç¬¦</p>
                            <p><strong>ä»»åŠ¡IDï¼š</strong>${data.taskId}</p>
                            ${data.note ? `<p><strong>æ³¨æ„ï¼š</strong>${data.note}</p>` : ''}
                        </div>
                    `;
                } else {
                    document.getElementById('results').innerHTML = `
                        <div class="url-item error">
                            <h3>âŒ å¤„ç†å¤±è´¥</h3>
                            <p>${data.error}</p>
                            ${data.suggestion ? `<p><strong>å»ºè®®ï¼š</strong>${data.suggestion}</p>` : ''}
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('results').innerHTML = `
                    <div class="url-item error">
                        <strong>âŒ ç½‘ç»œé”™è¯¯</strong>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // å›è½¦é”®è§¦å‘åˆ†æ
        document.getElementById('douyinUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                analyzeMedia();
            }
        });
    </script>
</body>
</html>