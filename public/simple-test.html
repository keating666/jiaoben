<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘è„šæœ¬ç”Ÿæˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.1);
            padding: 32px;
            max-width: 500px;
            width: 100%;
        }
        
        h1 {
            color: #1e293b;
            margin-bottom: 24px;
            text-align: center;
            font-size: 24px;
            font-weight: 600;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        input, textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s;
            background: #fafafa;
        }
        
        input:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            background: white;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        input::placeholder {
            color: #94a3b8;
        }
        
        button {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            transition: all 0.2s;
        }
        
        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            margin-top: 24px;
            display: none;
        }
        
        .result.show {
            display: block;
        }
        
        .result-content {
            background: #f1f5f9;
            border-radius: 8px;
            padding: 16px;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .success .result-content {
            background: #ecfdf5;
            border: 1px solid #bbf7d0;
        }
        
        .error .result-content {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: #dc2626;
        }
        
        .loading {
            text-align: center;
            color: #64748b;
            padding: 20px;
        }
        
        .spinner {
            border: 2px solid #e2e8f0;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 0 auto 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .meta {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 8px;
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¬ è§†é¢‘è„šæœ¬ç”Ÿæˆ</h1>
        
        <div class="input-group">
            <input type="text" id="video-url" placeholder="ç²˜è´´è§†é¢‘é“¾æ¥..." />
        </div>
        
        <button id="generate-btn" onclick="generateScript()">ç”Ÿæˆè„šæœ¬</button>
        
        <div id="result" class="result">
            <div id="result-content" class="result-content"></div>
            <div id="meta" class="meta"></div>
        </div>
    </div>
    
    <script>
        async function generateScript() {
            const url = document.getElementById('video-url').value.trim();
            const btn = document.getElementById('generate-btn');
            const result = document.getElementById('result');
            const content = document.getElementById('result-content');
            const meta = document.getElementById('meta');
            
            if (!url) {
                alert('è¯·è¾“å…¥è§†é¢‘é“¾æ¥');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            btn.disabled = true;
            btn.textContent = 'ç”Ÿæˆä¸­...';
            result.classList.add('show');
            result.className = 'result show';
            
            const startTime = Date.now();
            let elapsedSeconds = 0;
            
            // åˆå§‹æ˜¾ç¤º
            content.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨å¤„ç†è§†é¢‘...<br><small style="color: #64748b; margin-top: 8px; display: block;">â±ï¸ é¢„è®¡éœ€è¦ 30-60 ç§’ï¼Œè¯·è€å¿ƒç­‰å¾…</small><small id="elapsed" style="color: #94a3b8; margin-top: 4px; display: block;">å·²ç­‰å¾…: 0 ç§’</small></div>';
            
            // æ›´æ–°å·²ç­‰å¾…æ—¶é—´
            const timer = setInterval(() => {
                elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
                const elapsedEl = document.getElementById('elapsed');
                if (elapsedEl) {
                    elapsedEl.textContent = `å·²ç­‰å¾…: ${elapsedSeconds} ç§’`;
                }
            }, 1000);
            
            try {
                // ä½¿ç”¨ä¸åŸé¡µé¢ç›¸åŒçš„é…ç½®
                const response = await fetch('https://jiaoben-api.keating8500.workers.dev/api/process', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        douyinUrl: url  // ä½¿ç”¨æ­£ç¡®çš„å‚æ•°å 'douyinUrl'
                    })
                });
                
                const elapsed = Date.now() - startTime;
                const data = await response.json();
                
                // æ¸…é™¤å®šæ—¶å™¨
                clearInterval(timer);
                
                if (data.success) {
                    result.className = 'result show success';
                    
                    // æ ¼å¼åŒ–è¾“å‡º
                    let output = '';
                    
                    // æ˜¾ç¤ºè½¬å†™å†…å®¹
                    if (data.transcript) {
                        output += `ğŸ“ è½¬å†™å†…å®¹ï¼š\n${data.transcript}\n\n`;
                    }
                    
                    // æ˜¾ç¤ºåˆ†é•œè„šæœ¬
                    if (data.script) {
                        output += `ğŸ¬ åˆ†é•œè„šæœ¬ï¼š\n`;
                        if (typeof data.script === 'string') {
                            output += data.script;
                        } else {
                            output += JSON.stringify(data.script, null, 2);
                        }
                    }
                    
                    // å¦‚æœéƒ½æ²¡æœ‰ï¼Œæ˜¾ç¤ºåŸå§‹æ•°æ®
                    if (!data.transcript && !data.script) {
                        output = JSON.stringify(data, null, 2);
                    }
                    
                    content.textContent = output;
                    meta.textContent = `è€—æ—¶ ${elapsed}ms`;
                    
                } else {
                    result.className = 'result show error';
                    content.textContent = data.error || data.message || 'å¤„ç†å¤±è´¥';
                    meta.textContent = `è€—æ—¶ ${elapsed}ms`;
                }
                
            } catch (error) {
                // æ¸…é™¤å®šæ—¶å™¨
                clearInterval(timer);
                const elapsed = Date.now() - startTime;
                result.className = 'result show error';
                content.textContent = `ç½‘ç»œé”™è¯¯: ${error.message}`;
                meta.textContent = `è€—æ—¶ ${elapsed}ms`;
            }
            
            btn.disabled = false;
            btn.textContent = 'ç”Ÿæˆè„šæœ¬';
        }
        
        // æ”¯æŒå›è½¦é”®
        document.getElementById('video-url').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                generateScript();
            }
        });
        
        // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†
        window.addEventListener('load', function() {
            document.getElementById('video-url').focus();
        });
    </script>
</body>
</html>