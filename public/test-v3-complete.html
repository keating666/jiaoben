<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•å®Œæ•´çš„ V3 APIï¼ˆå«å›è°ƒï¼‰</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .input-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        button {
            background-color: #0070f3;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 10px;
        }
        button:hover {
            background-color: #0051cc;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            background-color: #f0f0f0;
            min-height: 100px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }
        #result {
            margin-top: 20px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 5px;
            border: 1px solid #e0e0e0;
        }
        .error { color: #d32f2f; }
        .success { color: #388e3c; }
        .info { color: #1976d2; }
        .warning { color: #f57c00; }
        
        .api-info {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .scene-card {
            background: #f5f5f5;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #0070f3;
        }
        
        .providers {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }
        .provider-badge {
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        .provider-success { background: #c8e6c9; color: #2e7d32; }
        .provider-fail { background: #ffcdd2; color: #c62828; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¬ è§†é¢‘è½¬æ–‡å­—è„šæœ¬ç”Ÿæˆå™¨ V3</h1>
        
        <div class="api-info">
            <strong>API é›†æˆçŠ¶æ€ï¼š</strong>
            <ul style="margin: 5px 0;">
                <li>TikHub - è§†é¢‘åœ°å€è§£æï¼ˆéœ€è¦é‚®ç®±éªŒè¯ï¼‰</li>
                <li>äº‘çŒ«ï¼ˆå¹¿å¸†ï¼‰- è§†é¢‘è½¬æ–‡å­—ï¼ˆå¼‚æ­¥å›è°ƒæ¨¡å¼ï¼‰</li>
                <li>é€šä¹‰åƒé—® - è„šæœ¬ç”Ÿæˆï¼ˆå®æ—¶ï¼‰</li>
            </ul>
        </div>
        
        <div class="input-group">
            <label for="inputType">è¾“å…¥æ–¹å¼ï¼š</label>
            <select id="inputType" onchange="toggleInput()">
                <option value="mixedText">æ··åˆæ–‡æœ¬ï¼ˆè‡ªåŠ¨æå–é“¾æ¥ï¼‰</option>
                <option value="videoUrl">ç›´æ¥è§†é¢‘é“¾æ¥</option>
            </select>
        </div>
        
        <div id="mixedTextGroup" class="input-group">
            <label for="mixedText">è¾“å…¥åŒ…å«è§†é¢‘é“¾æ¥çš„æ–‡æœ¬ï¼š</label>
            <textarea id="mixedText" placeholder="çœ‹è¿™ä¸ªè§†é¢‘ https://v.douyin.com/xxx/ å¤ªå¥½ç¬‘äº†">çœ‹è¿™ä¸ªæŠ–éŸ³è§†é¢‘ https://www.douyin.com/video/7234567890123456789 å¾ˆæœ‰æ„æ€</textarea>
        </div>
        
        <div id="videoUrlGroup" class="input-group" style="display: none;">
            <label for="videoUrl">è§†é¢‘é“¾æ¥ï¼š</label>
            <input type="text" id="videoUrl" placeholder="https://v.douyin.com/xxx/">
        </div>
        
        <div class="input-group">
            <label for="style">è„šæœ¬é£æ ¼ï¼š</label>
            <select id="style">
                <option value="default">æ ‡å‡†</option>
                <option value="humorous">å¹½é»˜</option>
                <option value="professional">ä¸“ä¸š</option>
            </select>
        </div>
        
        <button onclick="testAPI()" id="testBtn">ç”Ÿæˆè„šæœ¬</button>
        
        <div id="status"></div>
        <div id="result" style="display: none;"></div>
    </div>

    <script>
        let isProcessing = false;
        
        function toggleInput() {
            const inputType = document.getElementById('inputType').value;
            document.getElementById('mixedTextGroup').style.display = 
                inputType === 'mixedText' ? 'block' : 'none';
            document.getElementById('videoUrlGroup').style.display = 
                inputType === 'videoUrl' ? 'block' : 'none';
        }
        
        function log(message, type = 'info') {
            const status = document.getElementById('status');
            const timestamp = new Date().toLocaleTimeString();
            const className = type;
            status.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            status.scrollTop = status.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('status').innerHTML = '';
        }
        
        async function testAPI() {
            if (isProcessing) return;
            
            const btn = document.getElementById('testBtn');
            const resultDiv = document.getElementById('result');
            
            isProcessing = true;
            btn.disabled = true;
            btn.textContent = 'å¤„ç†ä¸­...';
            clearLog();
            resultDiv.style.display = 'none';
            
            const inputType = document.getElementById('inputType').value;
            const style = document.getElementById('style').value;
            
            let requestData = { style };
            
            if (inputType === 'mixedText') {
                requestData.mixedText = document.getElementById('mixedText').value;
            } else {
                requestData.videoUrl = document.getElementById('videoUrl').value;
            }
            
            log('å¼€å§‹å¤„ç†è¯·æ±‚...', 'info');
            log(`è¾“å…¥ç±»å‹: ${inputType}, é£æ ¼: ${style}`, 'info');
            
            try {
                const response = await fetch('/api/video/transcribe-v3-simple', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer test-api-key-123'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    log('âœ… å¤„ç†æˆåŠŸï¼', 'success');
                    log(`å¤„ç†æ—¶é—´: ${data.data.processingTime}ms`, 'info');
                    
                    // æ˜¾ç¤ºæœåŠ¡æä¾›å•†
                    displayProviders(data.data.provider);
                    
                    // æ˜¾ç¤ºç»“æœ
                    displayResult(data.data);
                } else {
                    log(`âŒ é”™è¯¯: ${data.error?.message || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    if (data.error?.code) {
                        log(`é”™è¯¯ä»£ç : ${data.error.code}`, 'error');
                    }
                }
            } catch (error) {
                log(`âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            } finally {
                isProcessing = false;
                btn.disabled = false;
                btn.textContent = 'ç”Ÿæˆè„šæœ¬';
            }
        }
        
        function displayProviders(providers) {
            log('\næœåŠ¡ä½¿ç”¨æƒ…å†µ:', 'info');
            
            const providerInfo = {
                videoResolver: {
                    name: 'è§†é¢‘è§£æ',
                    expected: 'TikHub'
                },
                transcription: {
                    name: 'è§†é¢‘è½¬æ–‡å­—',
                    expected: 'Yunmao'
                },
                scriptGenerator: {
                    name: 'è„šæœ¬ç”Ÿæˆ',
                    expected: 'TongYi'
                }
            };
            
            for (const [key, value] of Object.entries(providers)) {
                const info = providerInfo[key];
                if (info) {
                    const status = value === info.expected ? 'âœ…' : 'âš ï¸ é™çº§';
                    const type = value === info.expected ? 'success' : 'warning';
                    log(`${info.name}: ${value} ${status}`, type);
                }
            }
        }
        
        function displayResult(data) {
            const resultDiv = document.getElementById('result');
            
            let html = '<h3>ç”Ÿæˆçš„è„šæœ¬</h3>';
            
            // åŸå§‹æ–‡æœ¬
            if (data.originalText) {
                html += '<h4>è½¬å½•æ–‡æœ¬ï¼š</h4>';
                html += `<p>${data.originalText.substring(0, 200)}${data.originalText.length > 200 ? '...' : ''}</p>`;
                html += `<p><small>æ–‡æœ¬é•¿åº¦: ${data.originalText.length} å­—ç¬¦</small></p>`;
            }
            
            // è„šæœ¬åœºæ™¯
            if (data.script && data.script.scenes) {
                html += '<h4>åˆ†é•œå¤´è„šæœ¬ï¼š</h4>';
                data.script.scenes.forEach(scene => {
                    html += `
                        <div class="scene-card">
                            <strong>åœºæ™¯ ${scene.scene_number}</strong> 
                            <small>(${scene.timestamp})</small>
                            <p><strong>æè¿°ï¼š</strong>${scene.description}</p>
                            ${scene.dialogue ? `<p><strong>å¯¹è¯ï¼š</strong>${scene.dialogue}</p>` : ''}
                            ${scene.notes ? `<p><strong>å¤‡æ³¨ï¼š</strong>${scene.notes}</p>` : ''}
                        </div>
                    `;
                });
            }
            
            resultDiv.innerHTML = html;
            resultDiv.style.display = 'block';
        }
        
        // é¡µé¢åŠ è½½æ—¶çš„æç¤º
        window.onload = function() {
            log('é¡µé¢å·²åŠ è½½ï¼Œå‡†å¤‡å°±ç»ª', 'success');
            log('æç¤ºï¼šå½“å‰ä½¿ç”¨æµ‹è¯•è§†é¢‘URLï¼Œäº‘çŒ«å¯èƒ½æŠ¥é”™', 'warning');
            log('TikHub éœ€è¦é‚®ç®±éªŒè¯æ‰èƒ½æ­£å¸¸å·¥ä½œ', 'warning');
        };
    </script>
</body>
</html>