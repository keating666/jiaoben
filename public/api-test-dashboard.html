<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘è½¬æ–‡å­— API æµ‹è¯•ä»ªè¡¨æ¿</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            margin: 0;
            padding: 0;
            background: #f0f2f5;
            color: #333;
        }
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px 0;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        .config-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }
        .test-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-card h3 {
            margin-top: 0;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        input[type="text"], input[type="password"], select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 5px 0;
            font-size: 14px;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }
        button:hover {
            background: #2980b9;
        }
        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }
        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-success { background: #27ae60; }
        .status-error { background: #e74c3c; }
        .status-pending { background: #f39c12; }
        .test-controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ¯ è§†é¢‘è½¬æ–‡å­— API æµ‹è¯•ä»ªè¡¨æ¿</h1>
        <p>å®Œæ•´çš„ API åŠŸèƒ½æµ‹è¯•å’Œæ€§èƒ½ç›‘æ§</p>
    </div>

    <div class="container">
        <!-- é…ç½®éƒ¨åˆ† -->
        <div class="config-section">
            <h2>âš™ï¸ API é…ç½®</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                <div>
                    <label>API Token (ç•™ç©ºä½¿ç”¨æµ‹è¯• Token):</label>
                    <input type="password" id="api-token" placeholder="ç•™ç©ºä½¿ç”¨é»˜è®¤æµ‹è¯• Token">
                </div>
                <div>
                    <label>API ç«¯ç‚¹:</label>
                    <select id="api-endpoint">
                        <option value="https://jiaoben-7jx4.vercel.app">ç”Ÿäº§ç¯å¢ƒ (Vercel)</option>
                        <option value="http://localhost:3000">æœ¬åœ°å¼€å‘</option>
                    </select>
                </div>
                <div>
                    <label>æµ‹è¯•è§†é¢‘ URL:</label>
                    <input type="text" id="test-video-url" value="https://www.youtube.com/watch?v=dQw4w9WgXcQ">
                </div>
            </div>
            <div style="margin-top: 15px;">
                <button onclick="saveConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
                <button onclick="loadConfig()">ğŸ“¥ åŠ è½½é…ç½®</button>
            </div>
        </div>

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="total-tests">0</div>
                <div class="stat-label">æ€»æµ‹è¯•æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="success-tests">0</div>
                <div class="stat-label">æˆåŠŸæµ‹è¯•</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="failed-tests">0</div>
                <div class="stat-label">å¤±è´¥æµ‹è¯•</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avg-response-time">0ms</div>
                <div class="stat-label">å¹³å‡å“åº”æ—¶é—´</div>
            </div>
        </div>

        <!-- æµ‹è¯•å¡ç‰‡ -->
        <div class="test-grid">
            <!-- å¥åº·æ£€æŸ¥ -->
            <div class="test-card">
                <h3><span class="status-indicator status-pending"></span>å¥åº·æ£€æŸ¥</h3>
                <p>æ£€æŸ¥ API æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ</p>
                <button onclick="runTest('health')">ğŸ¥ è¿è¡Œæµ‹è¯•</button>
                <div id="health-result" class="result"></div>
            </div>

            <!-- å®Œæ•´æµç¨‹æµ‹è¯• -->
            <div class="test-card">
                <h3><span class="status-indicator status-pending"></span>å®Œæ•´è½¬å½•æµ‹è¯•</h3>
                <p>æµ‹è¯•è§†é¢‘ä¸‹è½½ã€éŸ³é¢‘æå–ã€è¯­éŸ³è½¬æ–‡å­—ã€è„šæœ¬ç”Ÿæˆå…¨æµç¨‹</p>
                <div class="test-controls">
                    <button onclick="runTest('transcribe')">ğŸ¬ è¿è¡Œæµ‹è¯•</button>
                    <button onclick="runTest('transcribe', true)">âš¡ å¿«é€Ÿæµ‹è¯• (çŸ­è§†é¢‘)</button>
                </div>
                <div id="transcribe-result" class="result"></div>
            </div>

            <!-- è®¤è¯æµ‹è¯• -->
            <div class="test-card">
                <h3><span class="status-indicator status-pending"></span>è®¤è¯æµ‹è¯•</h3>
                <p>æµ‹è¯• API Token éªŒè¯æœºåˆ¶</p>
                <button onclick="runTest('auth')">ğŸ” è¿è¡Œæµ‹è¯•</button>
                <div id="auth-result" class="result"></div>
            </div>

            <!-- å‚æ•°éªŒè¯æµ‹è¯• -->
            <div class="test-card">
                <h3><span class="status-indicator status-pending"></span>å‚æ•°éªŒè¯</h3>
                <p>æµ‹è¯•å¿…éœ€å‚æ•°å’Œå‚æ•°æ ¼å¼éªŒè¯</p>
                <button onclick="runTest('validation')">ğŸ“ è¿è¡Œæµ‹è¯•</button>
                <div id="validation-result" class="result"></div>
            </div>

            <!-- SSRF é˜²æŠ¤æµ‹è¯• -->
            <div class="test-card">
                <h3><span class="status-indicator status-pending"></span>SSRF é˜²æŠ¤</h3>
                <p>æµ‹è¯•å†…ç½‘åœ°å€è®¿é—®é™åˆ¶</p>
                <button onclick="runTest('ssrf')">ğŸ›¡ï¸ è¿è¡Œæµ‹è¯•</button>
                <div id="ssrf-result" class="result"></div>
            </div>

            <!-- å¹¶å‘æ§åˆ¶æµ‹è¯• -->
            <div class="test-card">
                <h3><span class="status-indicator status-pending"></span>å¹¶å‘æ§åˆ¶</h3>
                <p>æµ‹è¯•å¹¶å‘è¯·æ±‚é™åˆ¶ï¼ˆæœ€å¤š3ä¸ªï¼‰</p>
                <button onclick="runTest('concurrency')">ğŸ”„ è¿è¡Œæµ‹è¯•</button>
                <div id="concurrency-result" class="result"></div>
            </div>

            <!-- é”™è¯¯å¤„ç†æµ‹è¯• -->
            <div class="test-card">
                <h3><span class="status-indicator status-pending"></span>é”™è¯¯å¤„ç†</h3>
                <p>æµ‹è¯•å„ç§é”™è¯¯åœºæ™¯çš„å¤„ç†</p>
                <button onclick="runTest('error')">âš ï¸ è¿è¡Œæµ‹è¯•</button>
                <div id="error-result" class="result"></div>
            </div>

            <!-- æ€§èƒ½æµ‹è¯• -->
            <div class="test-card">
                <h3><span class="status-indicator status-pending"></span>æ€§èƒ½æµ‹è¯•</h3>
                <p>æµ‹è¯•å“åº”æ—¶é—´å’Œè¶…æ—¶å¤„ç†</p>
                <button onclick="runTest('performance')">ğŸ“Š è¿è¡Œæµ‹è¯•</button>
                <div id="performance-result" class="result"></div>
            </div>
        </div>

        <!-- æ‰¹é‡æµ‹è¯• -->
        <div class="config-section" style="margin-top: 20px;">
            <h2>ğŸš€ æ‰¹é‡æµ‹è¯•</h2>
            <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button onclick="runCriticalTests()">ä»…è¿è¡Œå…³é”®æµ‹è¯•</button>
            <button onclick="clearResults()">æ¸…é™¤æ‰€æœ‰ç»“æœ</button>
        </div>
    </div>

    <script>
        // é…ç½®
        let config = {
            apiToken: '',
            apiEndpoint: 'https://jiaoben-7jx4.vercel.app',
            testVideoUrl: 'https://www.youtube.com/watch?v=dQw4w9WgXcQ'
        };

        // ç»Ÿè®¡æ•°æ®
        let stats = {
            total: 0,
            success: 0,
            failed: 0,
            responseTimes: []
        };

        // åŠ è½½é…ç½®
        function loadConfig() {
            const saved = localStorage.getItem('apiTestConfig');
            if (saved) {
                config = JSON.parse(saved);
                document.getElementById('api-token').value = config.apiToken || '';
                document.getElementById('api-endpoint').value = config.apiEndpoint;
                document.getElementById('test-video-url').value = config.testVideoUrl;
            }
        }

        // ä¿å­˜é…ç½®
        function saveConfig() {
            config.apiToken = document.getElementById('api-token').value;
            config.apiEndpoint = document.getElementById('api-endpoint').value;
            config.testVideoUrl = document.getElementById('test-video-url').value;
            localStorage.setItem('apiTestConfig', JSON.stringify(config));
            alert('é…ç½®å·²ä¿å­˜ï¼');
        }

        // è·å– API Token
        function getApiToken() {
            return config.apiToken || 'test-token-12345678901234567890123456789012';
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, content, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = content;
            element.className = `result ${type}`;
            element.style.display = 'block';
            
            // æ›´æ–°çŠ¶æ€æŒ‡ç¤ºå™¨
            const card = element.closest('.test-card');
            const indicator = card.querySelector('.status-indicator');
            indicator.className = 'status-indicator status-' + (type === 'success' ? 'success' : type === 'error' ? 'error' : 'pending');
        }

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            document.getElementById('total-tests').textContent = stats.total;
            document.getElementById('success-tests').textContent = stats.success;
            document.getElementById('failed-tests').textContent = stats.failed;
            
            if (stats.responseTimes.length > 0) {
                const avg = stats.responseTimes.reduce((a, b) => a + b, 0) / stats.responseTimes.length;
                document.getElementById('avg-response-time').textContent = Math.round(avg) + 'ms';
            }
        }

        // è¿è¡Œæµ‹è¯•
        async function runTest(testType, quick = false) {
            const startTime = Date.now();
            stats.total++;
            updateStats();

            try {
                let result;
                switch(testType) {
                    case 'health':
                        result = await testHealth();
                        break;
                    case 'transcribe':
                        result = await testTranscribe(quick);
                        break;
                    case 'auth':
                        result = await testAuth();
                        break;
                    case 'validation':
                        result = await testValidation();
                        break;
                    case 'ssrf':
                        result = await testSSRF();
                        break;
                    case 'concurrency':
                        result = await testConcurrency();
                        break;
                    case 'error':
                        result = await testErrorHandling();
                        break;
                    case 'performance':
                        result = await testPerformance();
                        break;
                }
                
                const responseTime = Date.now() - startTime;
                stats.responseTimes.push(responseTime);
                
                if (result.success) {
                    stats.success++;
                } else {
                    stats.failed++;
                }
                
                updateStats();
            } catch (error) {
                stats.failed++;
                updateStats();
                showResult(`${testType}-result`, `æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // å„é¡¹æµ‹è¯•å®ç°
        async function testHealth() {
            showResult('health-result', 'â³ æ£€æŸ¥ API å¥åº·çŠ¶æ€...', 'info');
            
            const response = await fetch(`${config.apiEndpoint}/api`);
            const data = await response.json();
            
            if (response.ok) {
                showResult('health-result', `âœ… API å¥åº·æ£€æŸ¥é€šè¿‡ï¼\n\n${JSON.stringify(data, null, 2)}`, 'success');
                return { success: true };
            } else {
                showResult('health-result', `âŒ API å¥åº·æ£€æŸ¥å¤±è´¥\n\n${JSON.stringify(data, null, 2)}`, 'error');
                return { success: false };
            }
        }

        async function testTranscribe(quick = false) {
            const videoUrl = quick ? 'https://www.youtube.com/watch?v=jNQXAC9IVRw' : config.testVideoUrl;
            showResult('transcribe-result', 'â³ å¼€å§‹è§†é¢‘è½¬å½•æµ‹è¯•ï¼Œè¯·è€å¿ƒç­‰å¾… 30-60 ç§’...', 'info');
            
            const response = await fetch(`${config.apiEndpoint}/api/video/transcribe`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${getApiToken()}`
                },
                body: JSON.stringify({
                    videoUrl: videoUrl,
                    style: 'default',
                    language: 'zh'
                })
            });
            
            const data = await response.json();
            
            if (response.ok && data.success) {
                const result = `âœ… è§†é¢‘è½¬å½•æˆåŠŸï¼

è§†é¢‘ä¿¡æ¯:
- æ ‡é¢˜: ${data.data.videoInfo?.title || 'æœªçŸ¥'}
- æ—¶é•¿: ${data.data.duration} ç§’
- æ ¼å¼: ${data.data.videoInfo?.format || 'æœªçŸ¥'}

è½¬å½•ç»“æœ:
- æ–‡æœ¬é•¿åº¦: ${data.data.transcript.length} å­—ç¬¦
- è„šæœ¬åœºæ™¯æ•°: ${data.data.script?.scenes?.length || 0} ä¸ª

è½¬å½•æ–‡æœ¬é¢„è§ˆ:
${data.data.transcript.substring(0, 300)}...

ç¬¬ä¸€ä¸ªåœºæ™¯:
${JSON.stringify(data.data.script?.scenes?.[0] || {}, null, 2)}`;
                
                showResult('transcribe-result', result, 'success');
                return { success: true };
            } else {
                showResult('transcribe-result', `âŒ è§†é¢‘è½¬å½•å¤±è´¥\n\n${JSON.stringify(data, null, 2)}`, 'error');
                return { success: false };
            }
        }

        async function testAuth() {
            showResult('auth-result', 'â³ æµ‹è¯•è®¤è¯æœºåˆ¶...', 'info');
            
            // æµ‹è¯•æ—  Token
            const response1 = await fetch(`${config.apiEndpoint}/api/video/transcribe`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    videoUrl: config.testVideoUrl
                })
            });
            
            // æµ‹è¯•é”™è¯¯ Token
            const response2 = await fetch(`${config.apiEndpoint}/api/video/transcribe`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer invalid-token'
                },
                body: JSON.stringify({
                    videoUrl: config.testVideoUrl
                })
            });
            
            const data1 = await response1.json();
            const data2 = await response2.json();
            
            if (response1.status === 401 && response2.status === 401) {
                showResult('auth-result', `âœ… è®¤è¯æµ‹è¯•é€šè¿‡ï¼

æ—  Token å“åº”: ${response1.status}
${JSON.stringify(data1, null, 2)}

æ— æ•ˆ Token å“åº”: ${response2.status}
${JSON.stringify(data2, null, 2)}`, 'success');
                return { success: true };
            } else {
                showResult('auth-result', `âŒ è®¤è¯æµ‹è¯•å¤±è´¥

æµ‹è¯•1çŠ¶æ€: ${response1.status}
æµ‹è¯•2çŠ¶æ€: ${response2.status}`, 'error');
                return { success: false };
            }
        }

        async function testValidation() {
            showResult('validation-result', 'â³ æµ‹è¯•å‚æ•°éªŒè¯...', 'info');
            
            const tests = [
                {
                    name: 'ç¼ºå°‘ videoUrl',
                    body: { style: 'default' }
                },
                {
                    name: 'æ— æ•ˆ URL æ ¼å¼',
                    body: { videoUrl: 'not-a-url' }
                },
                {
                    name: 'ç©ºå­—ç¬¦ä¸² URL',
                    body: { videoUrl: '' }
                }
            ];
            
            let results = [];
            for (const test of tests) {
                const response = await fetch(`${config.apiEndpoint}/api/video/transcribe`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${getApiToken()}`
                    },
                    body: JSON.stringify(test.body)
                });
                
                const data = await response.json();
                results.push({
                    test: test.name,
                    status: response.status,
                    passed: response.status === 400
                });
            }
            
            const allPassed = results.every(r => r.passed);
            const resultText = results.map(r => 
                `${r.passed ? 'âœ…' : 'âŒ'} ${r.test}: ${r.status}`
            ).join('\n');
            
            if (allPassed) {
                showResult('validation-result', `âœ… å‚æ•°éªŒè¯æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼\n\n${resultText}`, 'success');
                return { success: true };
            } else {
                showResult('validation-result', `âŒ éƒ¨åˆ†å‚æ•°éªŒè¯æµ‹è¯•å¤±è´¥\n\n${resultText}`, 'error');
                return { success: false };
            }
        }

        async function testSSRF() {
            showResult('ssrf-result', 'â³ æµ‹è¯• SSRF é˜²æŠ¤...', 'info');
            
            const dangerousUrls = [
                'http://localhost:8080/video.mp4',
                'http://127.0.0.1/video.mp4',
                'http://192.168.1.1/video.mp4',
                'http://10.0.0.1/video.mp4',
                'http://[::1]/video.mp4'
            ];
            
            let results = [];
            for (const url of dangerousUrls) {
                const response = await fetch(`${config.apiEndpoint}/api/video/transcribe`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${getApiToken()}`
                    },
                    body: JSON.stringify({ videoUrl: url })
                });
                
                const data = await response.json();
                results.push({
                    url: url,
                    blocked: response.status === 400 && data.error?.message?.includes('ä¸å…è®¸è®¿é—®')
                });
            }
            
            const allBlocked = results.every(r => r.blocked);
            const resultText = results.map(r => 
                `${r.blocked ? 'âœ…' : 'âŒ'} ${r.url}: ${r.blocked ? 'å·²æ‹¦æˆª' : 'æœªæ‹¦æˆª'}`
            ).join('\n');
            
            if (allBlocked) {
                showResult('ssrf-result', `âœ… SSRF é˜²æŠ¤æµ‹è¯•é€šè¿‡ï¼æ‰€æœ‰å†…ç½‘åœ°å€éƒ½è¢«æ­£ç¡®æ‹¦æˆª\n\n${resultText}`, 'success');
                return { success: true };
            } else {
                showResult('ssrf-result', `âŒ SSRF é˜²æŠ¤æµ‹è¯•å¤±è´¥ï¼éƒ¨åˆ†å†…ç½‘åœ°å€æœªè¢«æ‹¦æˆª\n\n${resultText}`, 'error');
                return { success: false };
            }
        }

        async function testConcurrency() {
            showResult('concurrency-result', 'â³ æµ‹è¯•å¹¶å‘æ§åˆ¶...', 'info');
            
            // åŒæ—¶å‘é€ 5 ä¸ªè¯·æ±‚
            const promises = [];
            for (let i = 0; i < 5; i++) {
                promises.push(
                    fetch(`${config.apiEndpoint}/api/video/transcribe`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${getApiToken()}`
                        },
                        body: JSON.stringify({
                            videoUrl: config.testVideoUrl,
                            sessionId: `concurrent-test-${i}`
                        })
                    })
                );
            }
            
            const responses = await Promise.all(promises);
            const results = await Promise.all(responses.map(async (r, i) => ({
                request: i + 1,
                status: r.status,
                data: await r.json()
            })));
            
            const accepted = results.filter(r => r.status !== 429).length;
            const rejected = results.filter(r => r.status === 429).length;
            
            const resultText = `å‘é€è¯·æ±‚: 5
æ¥å—è¯·æ±‚: ${accepted}
æ‹’ç»è¯·æ±‚: ${rejected} (429 Too Many Requests)

è¯¦ç»†ç»“æœ:
${results.map(r => `è¯·æ±‚ ${r.request}: ${r.status} ${r.status === 429 ? '(è¢«é™æµ)' : '(å¤„ç†ä¸­)'}`).join('\n')}`;
            
            if (accepted <= 3 && rejected >= 2) {
                showResult('concurrency-result', `âœ… å¹¶å‘æ§åˆ¶æµ‹è¯•é€šè¿‡ï¼\n\n${resultText}`, 'success');
                return { success: true };
            } else {
                showResult('concurrency-result', `âŒ å¹¶å‘æ§åˆ¶æµ‹è¯•å¤±è´¥ï¼\n\n${resultText}`, 'error');
                return { success: false };
            }
        }

        async function testErrorHandling() {
            showResult('error-result', 'â³ æµ‹è¯•é”™è¯¯å¤„ç†...', 'info');
            
            const errorScenarios = [
                {
                    name: 'ä¸å­˜åœ¨çš„è§†é¢‘',
                    videoUrl: 'https://www.youtube.com/watch?v=invalid12345'
                },
                {
                    name: 'ç§æœ‰è§†é¢‘',
                    videoUrl: 'https://www.youtube.com/watch?v=private_video'
                },
                {
                    name: 'ä¸æ”¯æŒçš„ç½‘ç«™',
                    videoUrl: 'https://example.com/video.mp4'
                }
            ];
            
            let results = [];
            for (const scenario of errorScenarios) {
                try {
                    const response = await fetch(`${config.apiEndpoint}/api/video/transcribe`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${getApiToken()}`
                        },
                        body: JSON.stringify({ videoUrl: scenario.videoUrl })
                    });
                    
                    const data = await response.json();
                    results.push({
                        scenario: scenario.name,
                        handled: !response.ok && data.error,
                        errorMessage: data.error?.message || 'æ— é”™è¯¯ä¿¡æ¯'
                    });
                } catch (error) {
                    results.push({
                        scenario: scenario.name,
                        handled: false,
                        errorMessage: error.message
                    });
                }
            }
            
            const allHandled = results.every(r => r.handled);
            const resultText = results.map(r => 
                `${r.handled ? 'âœ…' : 'âŒ'} ${r.scenario}: ${r.errorMessage}`
            ).join('\n\n');
            
            if (allHandled) {
                showResult('error-result', `âœ… é”™è¯¯å¤„ç†æµ‹è¯•é€šè¿‡ï¼\n\n${resultText}`, 'success');
                return { success: true };
            } else {
                showResult('error-result', `âš ï¸ é”™è¯¯å¤„ç†æµ‹è¯•éƒ¨åˆ†é€šè¿‡\n\n${resultText}`, 'info');
                return { success: false };
            }
        }

        async function testPerformance() {
            showResult('performance-result', 'â³ æµ‹è¯•æ€§èƒ½...', 'info');
            
            const iterations = 3;
            const responseTimes = [];
            
            for (let i = 0; i < iterations; i++) {
                const startTime = Date.now();
                
                try {
                    const response = await fetch(`${config.apiEndpoint}/api`);
                    await response.json();
                    
                    const responseTime = Date.now() - startTime;
                    responseTimes.push(responseTime);
                } catch (error) {
                    responseTimes.push(-1);
                }
            }
            
            const validTimes = responseTimes.filter(t => t > 0);
            const avgTime = validTimes.reduce((a, b) => a + b, 0) / validTimes.length;
            const maxTime = Math.max(...validTimes);
            const minTime = Math.min(...validTimes);
            
            const resultText = `æµ‹è¯•æ¬¡æ•°: ${iterations}
æˆåŠŸæ¬¡æ•°: ${validTimes.length}

å“åº”æ—¶é—´:
- å¹³å‡: ${Math.round(avgTime)}ms
- æœ€å¿«: ${minTime}ms
- æœ€æ…¢: ${maxTime}ms

è¯¦ç»†æ•°æ®:
${responseTimes.map((t, i) => `æµ‹è¯• ${i + 1}: ${t > 0 ? t + 'ms' : 'å¤±è´¥'}`).join('\n')}`;
            
            if (validTimes.length === iterations && avgTime < 1000) {
                showResult('performance-result', `âœ… æ€§èƒ½æµ‹è¯•é€šè¿‡ï¼\n\n${resultText}`, 'success');
                return { success: true };
            } else {
                showResult('performance-result', `âš ï¸ æ€§èƒ½æµ‹è¯•ç»“æœ\n\n${resultText}`, 'info');
                return { success: false };
            }
        }

        // æ‰¹é‡æµ‹è¯•
        async function runAllTests() {
            const tests = ['health', 'transcribe', 'auth', 'validation', 'ssrf', 'concurrency', 'error', 'performance'];
            for (const test of tests) {
                await runTest(test);
                await new Promise(resolve => setTimeout(resolve, 1000)); // å»¶è¿Ÿ1ç§’
            }
        }

        async function runCriticalTests() {
            const tests = ['health', 'auth', 'ssrf', 'validation'];
            for (const test of tests) {
                await runTest(test);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        function clearResults() {
            document.querySelectorAll('.result').forEach(el => {
                el.style.display = 'none';
                el.textContent = '';
            });
            document.querySelectorAll('.status-indicator').forEach(el => {
                el.className = 'status-indicator status-pending';
            });
            stats = { total: 0, success: 0, failed: 0, responseTimes: [] };
            updateStats();
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = () => {
            loadConfig();
            // è‡ªåŠ¨è¿è¡Œå¥åº·æ£€æŸ¥
            runTest('health');
        };
    </script>
</body>
</html>