<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>äº‘çŒ«å¿«é€Ÿæµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; 
            margin: 50px auto; 
            padding: 20px;
        }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            cursor: pointer;
            background: #0070f3;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover { background: #0051cc; }
        #log { 
            background: #f5f5f5; 
            padding: 10px; 
            margin-top: 20px; 
            height: 300px; 
            overflow-y: auto;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ äº‘çŒ«å¿«é€Ÿæµ‹è¯•</h1>
    
    <div>
        <button onclick="test('tiny')">æµ‹è¯•5ç§’è§†é¢‘</button>
        <button onclick="test('small')">æµ‹è¯•10ç§’è§†é¢‘</button>
        <button onclick="test('default')">æµ‹è¯•30ç§’è§†é¢‘</button>
    </div>
    
    <div id="log"></div>
    
    <script>
        const videos = {
            tiny: 'https://www.w3schools.com/html/mov_bbb.mp4',
            small: 'https://sample-videos.com/video321/mp4/240/big_buck_bunny_240p_1mb.mp4',
            default: 'https://sample-videos.com/video321/mp4/720/big_buck_bunny_720p_1mb.mp4'
        };
        
        let taskId = null;
        let startTime = null;
        
        function log(msg) {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${time}] ${msg}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        async function test(type) {
            log(`å¼€å§‹æµ‹è¯• ${type} è§†é¢‘...`);
            startTime = Date.now();
            
            // æäº¤ä»»åŠ¡
            const res = await fetch('/api/video/submit-transcription-fetch', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    videoUrl: videos[type],
                    language: 'chinese'
                })
            });
            
            const data = await res.json();
            if (data.success) {
                taskId = data.data.taskId;
                log(`ä»»åŠ¡ID: ${taskId}`);
                checkStatus();
            } else {
                log(`é”™è¯¯: ${data.error.message}`);
            }
        }
        
        async function checkStatus() {
            if (!taskId) return;
            
            const res = await fetch(`/api/video/check-transcription?taskId=${taskId}`);
            const data = await res.json();
            
            if (data.success && data.data.status === 'completed') {
                const elapsed = Math.round((Date.now() - startTime) / 1000);
                log(`âœ… å®Œæˆï¼è€—æ—¶ ${elapsed} ç§’`);
                log(`ç»“æœ: ${data.data.text.substring(0, 100)}...`);
            } else {
                log('å¤„ç†ä¸­...');
                setTimeout(checkStatus, 3000);
            }
        }
        
        log('å‡†å¤‡å°±ç»ªï¼');
    </script>
</body>
</html>